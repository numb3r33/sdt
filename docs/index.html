---

title: SDT


keywords: fastai
sidebar: home_sidebar



nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Abstract</strong>
Deep neural networks have proved to be a very effective
way to perform classification tasks. But it is hard to explain why a learned network makes
a particular classification decision on a particular test case. This is
due to their reliance on distributed hierarchical representations. If we
could take the knowledge acquired by the neural net and express the
same knowledge in a model that relies on hierarchical decisions instead,
explaining a particular decision would be much easier. We describe a way
of using a trained neural net to create a type of soft decision tree that
generalizes better than one learned directly from the training data.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>pip install git+https://github.com/numb3r33/sdt.git</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="How-to-use">How to use<a class="anchor-link" href="#How-to-use"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">path</span> <span class="o">=</span> <span class="n">untar_data</span><span class="p">(</span><span class="n">URLs</span><span class="o">.</span><span class="n">MNIST</span><span class="p">)</span>
<span class="n">dls</span>  <span class="o">=</span> <span class="n">get_dls</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">bs</span><span class="o">=</span><span class="mi">128</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">current_depth</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">depth</span> <span class="o">=</span> <span class="mi">4</span>

<span class="n">tree</span>      <span class="o">=</span> <span class="n">Tree</span><span class="p">(</span><span class="n">input_dim</span><span class="o">=</span><span class="mi">784</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">n_leaves</span>  <span class="o">=</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">depth</span>
<span class="n">n_classes</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">n_epochs</span>  <span class="o">=</span> <span class="mi">40</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">sdt_init</span><span class="p">(</span><span class="n">current_depth</span> <span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">input_dim</span><span class="o">=</span><span class="mi">784</span><span class="p">,</span> <span class="n">output_dim</span><span class="o">=</span><span class="n">n_classes</span><span class="p">)</span>

<span class="c1"># SDT</span>
<span class="n">sdt</span>       <span class="o">=</span> <span class="n">SDT</span><span class="p">(</span><span class="n">tree</span><span class="o">=</span><span class="n">tree</span><span class="p">,</span> <span class="n">n_leaves</span><span class="o">=</span><span class="n">n_leaves</span><span class="p">,</span> <span class="n">n_classes</span><span class="o">=</span><span class="n">n_classes</span><span class="p">)</span>
<span class="n">criterion</span> <span class="o">=</span> <span class="n">SDTLoss</span><span class="p">(</span><span class="n">lambda_</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">Learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> 
                <span class="n">sdt</span><span class="p">,</span> 
                <span class="n">loss_func</span><span class="o">=</span><span class="n">criterion</span><span class="p">,</span> 
                <span class="n">opt_func</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">SGD</span><span class="p">,</span> <span class="n">lr</span><span class="o">=.</span><span class="mi">2</span><span class="p">,</span> <span class="n">mom</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span> 
                <span class="n">cbs</span><span class="o">=</span><span class="n">SDTCallback</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">n_leaves</span><span class="p">),</span> 
                <span class="n">metrics</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">accuracy_multi</span><span class="p">,</span> <span class="n">sigmoid</span><span class="o">=</span><span class="kc">False</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fit_one_cycle</span><span class="p">(</span><span class="n">n_epoch</span><span class="o">=</span><span class="n">n_epochs</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/sdt/images/training_loop.png" alt="training_loop"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Learned-Filters">Learned Filters<a class="anchor-link" href="#Learned-Filters"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="/sdt/images/learned_filters.png" alt="learned_filters"></p>

</div>
</div>
</div>
</div>
 

